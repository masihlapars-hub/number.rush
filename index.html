<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Number Rush — NEON STORM</title>
<meta http-equiv="Cache-Control" content="no-store, max-age=0"/>
<style>
  :root{
    --ink:#0f172a; --muted:#334155; --line:rgba(255,255,255,.35);
    --p1:#8b5cf6; --p2:#a78bfa; --ok:#22c55e; --err:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;
    /* dasar langit */
    background: linear-gradient(180deg,#bde0ff 0%,#a8d0ff 60%,#9bc8ff 100%);
    min-height:100svh;
    padding:max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right))
            max(12px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
    overflow:auto;
  }

  /* ================= SUPER BACKGROUND (sangat terlihat) ================= */
  .bg{position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden}
  /* diagonal neon strip bergerak */
  .neon{
    position:absolute; inset:-20%;
    background: repeating-linear-gradient(
      120deg,
      rgba(255,255,255,.06) 0 40px,
      rgba(255,255,255,0) 40px 80px
    ), linear-gradient(120deg,#ff80bf55,#80ffea55,#a78bfa55,#ffdd7a55);
    background-size: 100% 100%, 400% 400%;
    animation: neonShift 14s linear infinite;
    mix-blend-mode: screen;
  }
  @keyframes neonShift{ to{ background-position: 0 0, 400% 400%; } }

  /* aurora neon tebal */
  .aurora{
    position:absolute; inset:-10% -10% auto -10%; height:75%;
    background:
      radial-gradient(60% 140% at 15% 65%, #a78bfaaa 0%, transparent 60%),
      radial-gradient(60% 140% at 55% 35%, #22c55eaa 0%, transparent 60%),
      radial-gradient(60% 140% at 90% 75%, #60a5faaa 0%, transparent 60%);
    animation: auroraMove 12s ease-in-out infinite;
    mix-blend-mode: screen;
  }
  @keyframes auroraMove{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-6%) rotate(4deg)}}

  .sun{position:absolute; right:4vw; top:4vh; width:120px; height:120px; border-radius:50%;
       background:#ffd166; box-shadow:0 0 70px #ffd166cc, inset -16px -18px 0 #ffc43d; animation:pulse 4s ease-in-out infinite}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}

  .layer{position:absolute; inset:0}
  .cloud{position:absolute; background:#fff; border-radius:60px; filter:drop-shadow(0 12px 28px rgba(0,0,0,.2))}
  .cloud:before,.cloud:after{content:""; position:absolute; background:#fff; border-radius:80px}
  .cloud:before{width:70%; height:70%; left:-25%; top:10%}
  .cloud:after{width:55%; height:55%; right:-20%; top:20%}
  @keyframes driftRight{from{transform:translateX(-150%)} to{transform:translateX(150%)}}
  @keyframes driftLeft {from{transform:translateX(140%)} to{transform:translateX(-140%)}}
  .back .cloud{animation:driftRight var(--t,90s) linear infinite; opacity:.85}
  .mid  .cloud{animation:driftLeft  var(--t,48s) linear infinite; opacity:.9}
  .front.cloud{animation:driftRight var(--t,34s) linear infinite; opacity:.95}

  /* balon parade kontinu */
  .balloon{
    position:absolute; width:58px; height:76px; border-radius:50% 50% 45% 45%/60% 60% 40% 40%;
    background:radial-gradient(70% 90% at 35% 20%, #fff8, transparent), var(--col,#ff7ab6);
    box-shadow:0 12px 26px rgba(0,0,0,.28);
    animation: float 5.5s ease-in-out infinite, parade 18s linear infinite;
  }
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-22px)}}
  @keyframes parade{from{left:-20vw} to{left:120vw}}
  .balloon:after{content:""; position:absolute; left:50%; bottom:-12px; width:2px; height:28px; background:#6b7280; transform:translateX(-50%)}

  .star{position:absolute; width:6px; height:6px; background:#fff; border-radius:50%; box-shadow:0 0 12px 3px #fff}
  @keyframes twinkle{0%,100%{opacity:.2; transform:scale(.6)}50%{opacity:1; transform:scale(1)}}

  /* wind & sparkles sangat sering */
  .wind{position:absolute; top:0; width:180px; height:3px; background:linear-gradient(90deg,transparent,#ffffffee,transparent);
        filter:blur(.2px); opacity:.95; animation:blow var(--tw,3.2s) linear forwards}
  @keyframes blow{from{transform:translate(-20vw, var(--y))} to{transform:translate(120vw, var(--y))}}
  .sparkle{position:absolute; width:8px; height:8px; border-radius:50%; background:#fff; box-shadow:0 0 12px 4px #fff; animation:sparkle 1.2s ease-in-out forwards}
  @keyframes sparkle{0%{opacity:0; transform:scale(.6)}40%{opacity:1; transform:scale(1)}100%{opacity:0; transform:scale(.4)}}

  /* ================= GLASS UI ================= */
  .wrap{position:relative; z-index:1; display:grid; place-items:center; min-height:calc(100svh - 24px)}
  .card{
    width:min(1120px,100%);
    background:rgba(255,255,255,.22);
    backdrop-filter: blur(12px) saturate(170%);
    border:1px solid var(--line);
    border-radius:18px; box-shadow:0 18px 46px rgba(15,23,42,.25);
    overflow:hidden;
  }
  header{display:flex; gap:12px; align-items:center; padding:14px 16px; border-bottom:1px solid var(--line);
         background:linear-gradient(180deg, rgba(255,255,255,.34), rgba(255,255,255,.18))}
  .logo{width:30px; height:30px; display:grid; place-items:center; border-radius:10px; color:#fff; font-weight:800;
        background:conic-gradient(from 120deg, var(--p1), var(--p2))}
  header h1{font-size:18px; margin:0}
  .sub{font-size:12px; color:#1f2937}
  .content{display:grid; gap:14px; padding:14px}
  @media (min-width:980px){ .content{ grid-template-columns: 1.15fr .85fr; } }
  .panel{background:rgba(255,255,255,.18); border:1px solid var(--line); border-radius:16px; padding:14px; backdrop-filter: blur(10px)}
  .hud{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-bottom:10px}
  .stats{display:flex; gap:10px; flex-wrap:wrap}
  .chip{background:rgba(255,255,255,.55); border:1px solid var(--line); padding:8px 10px; border-radius:999px; font-size:13px; display:flex; gap:8px; align-items:center}
  .chip b{font-variant-numeric:tabular-nums}
  .chip.warn{box-shadow:0 0 0 3px #fecacaaa}
  select{border:1px solid var(--line); background:rgba(255,255,255,.95); padding:8px 10px; border-radius:10px; font-weight:700}
  .btn{appearance:none; border:0; background:linear-gradient(180deg, var(--p1), var(--p2)); color:#fff; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer; box-shadow:0 12px 28px rgba(124,58,237,.5)}
  .btn:active{transform:translateY(1px) scale(.99)}
  .toggle{appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.5); padding:8px 10px; border-radius:10px; font-weight:700; cursor:pointer}

  /* Board ekstra transparan + border glow berdenyut */
  .board-wrap{display:grid; place-items:center}
  .board{
    width:100%; max-width:100%;
    block-size:min(72svh, 76vw); aspect-ratio:1/1;
    background: transparent;
    border-radius:14px; display:grid; gap:8px; padding:10px; overflow:hidden;
    border:1px solid rgba(255,255,255,.45);
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.18), 0 18px 36px rgba(0,0,0,.14);
    animation: boardGlow 3.5s ease-in-out infinite;
  }
  @keyframes boardGlow{
    0%,100%{box-shadow: inset 0 0 0 2px rgba(255,255,255,.18), 0 18px 36px rgba(0,0,0,.14)}
    50%{box-shadow: inset 0 0 0 2px rgba(255,255,255,.5), 0 26px 60px rgba(0,0,0,.22)}
  }
  .cell{
    display:grid; place-items:center; background:#fff; border:1px solid #e5e7eb; border-radius:12px; font-weight:900;
    font-size: clamp(16px, 3.6cqi, 28px); user-select:none; cursor:pointer;
    transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
    box-shadow:0 8px 16px rgba(15,23,42,.14)
  }
  .cell:hover{ box-shadow:0 14px 24px rgba(15,23,42,.2) }
  .cell.correct{ background:#ecfdf5; border-color:#bbf7d0 }
  .cell.wrong{ background:#fef2f2; border-color:#fecaca }
  .shake{ animation:shake .28s linear }
  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}

  .title{font-weight:800; margin:0 0 6px}
  .sidebar p{margin:6px 0; color:#1f2937; font-size:14px}
  .list{display:grid; gap:8px}
  .row{display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border:1px dashed var(--line); border-radius:10px; background:rgba(255,255,255,.25)}
  .tag{font-size:12px; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#4338ca; border:1px solid #e0e7ff}

  .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%) translateY(60px); opacity:0; background:#111827; color:#fff; padding:10px 14px; border-radius:12px; box-shadow:0 10px 24px rgba(0,0,0,.2); z-index:3; transition: transform .25s ease, opacity .25s ease; font-size:14px}
  .toast.show{transform:translateX(-50%) translateY(0); opacity:1}
  .confetti{position:fixed; top:-10px; width:9px; height:14px; border-radius:2px; opacity:.95; pointer-events:none; z-index:2; animation:fall var(--t,2.6s) linear forwards}
  @keyframes fall{to{transform:translate3d(var(--x,0), 110svh, 0) rotate(720deg)}}
</style>
</head>
<body>
  <!-- BACKGROUND -->
  <div class="bg" aria-hidden="true">
    <div class="neon"></div>
    <div class="aurora"></div>
    <div class="sun"></div>
    <div class="layer back" id="lBack"></div>
    <div class="layer mid"  id="lMid"></div>
    <div class="layer"      id="lFront"></div>
  </div>

  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo">NR</div>
        <div>
          <h1>Number Rush — <b>NEON STORM</b></h1>
          <div class="sub">Transparan total + animasi ditonjolkan (neon strip, aurora, 3 lapis awan, balon parade, wind & sparkles).</div>
        </div>
      </header>

      <div class="content">
        <!-- LEFT -->
        <div class="panel">
          <div class="hud">
            <div class="stats">
              <div class="chip">Level:
                <select id="level">
                  <option value="1">1 • 1–20 • 25s</option>
                  <option value="2">2 • 1–30 • 35s</option>
                  <option value="3">3 • 1–40 • 45s</option>
                  <option value="4">4 • 1–50 • 55s</option>
                  <option value="5">5 • 1–60 • 65s</option>
                </select>
              </div>
              <div class="chip">Target: <b id="target">1</b></div>
              <div class="chip" id="chipTime">Sisa: <b id="time">25.000</b>s</div>
              <div class="chip">Rekor: <b id="best">—</b></div>
              <div class="chip">Combo: <b id="combo">0</b>/5</div>
            </div>
            <div style="display:flex; gap:8px; align-items:center">
              <button class="toggle" id="toggleChaos">Chaos: OFF</button>
              <button class="btn" id="btnStart">Mulai / Ulang</button>
            </div>
          </div>

          <div class="board-wrap">
            <div id="board" class="board"></div>
          </div>
        </div>

        <!-- RIGHT -->
        <aside class="panel sidebar">
          <h3 class="title">Aturan cepat</h3>
          <div class="list">
            <div class="row"><span>Countdown</span><span class="tag">habis → game over</span></div>
            <div class="row"><span>Combo</span><span class="tag">5 cepat → +3s</span></div>
            <div class="row"><span>Salah</span><span class="tag">-2s & shake</span></div>
            <div class="row"><span>Chaos Mode</span><span class="tag">grid goyang & angka geser</span></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Rekor baru! 🎉</div>

<script>
(()=> {
  const $=(s,o=document)=>o.querySelector(s);
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const shuffle=(a)=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};

  const levelSel=$('#level'), targetEl=$('#target'), timeEl=$('#time'), bestEl=$('#best'),
        chipTime=$('#chipTime'), board=$('#board'), btn=$('#btnStart'),
        toast=$('#toast'), comboEl=$('#combo'), chaosBtn=$('#toggleChaos');

  const LBack=$('#lBack'), LMid=$('#lMid'), LFront=$('#lFront');

  const levels={
    1:{max:20, cols:5, rows:4, time:25},
    2:{max:30, cols:6, rows:5, time:35},
    3:{max:40, cols:7, rows:6, time:45},
    4:{max:50, cols:8, rows:7, time:55},
    5:{max:60, cols:8, rows:8, time:65}
  };

  let seq=1, maxN=20, started=false, deadline=0, ticker=null, remaining=0;
  let lastHit=0, combo=0, chaos=false, chaosTimer=null;
  const audioCtx='AudioContext' in window ? new AudioContext() : null;

  /* ================= BACKGROUND BUILD ================= */
  function clearBG(){ LBack.innerHTML=''; LMid.innerHTML=''; LFront.innerHTML=''; }
  function mkCloud(parent, size=1, y=[12,80], fromLeft=true, dur=60){
    const c=document.createElement('div'); c.className='cloud';
    c.style.width=(160*size)+'px'; c.style.height=(70*size)+'px';
    c.style.top=rand(y[0],y[1])+'vh';
    c.style.left=fromLeft? rand(-160,-40)+'%' : rand(140,220)+'%';
    c.style.animation = fromLeft ? `driftRight ${dur}s linear infinite` : `driftLeft ${dur-16}s linear infinite`;
    parent.appendChild(c);
  }
  function mkBalloonRow(){
    const colors=['#ff7ab6','#ffd166','#34d399','#60a5fa','#a78bfa','#f472b6','#fb7185','#22d3ee','#f59e0b'];
    for(let i=0;i<10;i++){
      const b=document.createElement('div'); b.className='balloon';
      b.style.setProperty('--col', colors[i%colors.length]);
      b.style.top=rand(10,80)+'vh';
      b.style.left='-20vw';
      b.style.animationDelay=(i*1.2)+'s';
      LFront.appendChild(b);
    }
  }
  function mkStar(){
    const s=document.createElement('div'); s.className='star';
    s.style.left=rand(2,98)+'vw'; s.style.top=rand(6,60)+'vh';
    s.style.animation='twinkle '+(1.6+Math.random()*1.2)+'s ease-in-out infinite';
    LMid.appendChild(s);
  }
  function mkWind(){
    const w=document.createElement('div'); w.className='wind';
    w.style.setProperty('--y', rand(8,92)+'vh'); w.style.setProperty('--tw', (3+Math.random()*1.2)+'s');
    (Math.random()<.5?LBack:LMid).appendChild(w); w.addEventListener('animationend', ()=>w.remove());
  }
  function mkSparkle(){
    const sp=document.createElement('div'); sp.className='sparkle';
    sp.style.left=rand(4,96)+'vw'; sp.style.top=rand(8,60)+'vh';
    (Math.random()<.5?LMid:LFront).appendChild(sp); sp.addEventListener('animationend', ()=>sp.remove());
  }
  setInterval(mkWind, 250);
  setInterval(mkSparkle, 400);

  function buildSky(){
    clearBG();
    for(let i=0;i<8;i++) mkCloud(LBack, 1.4, [8,72], true, 100);
    for(let i=0;i<10;i++) mkCloud(LMid,  1.1, [12,78], true, 60);
    for(let i=0;i<10;i++) mkCloud(LFront,1.0, [18,84], false, 34);
    mkBalloonRow(); mkBalloonRow(); // dua gelombang
    for(let i=0;i<120;i++) mkStar();
  }

  /* ================= GRID ================= */
  function buildGrid(cfg){
    const {max, cols, rows, time}=cfg;
    maxN=max; seq=1; targetEl.textContent='1'; combo=0; comboEl.textContent='0';
    board.classList.remove('shake'); board.innerHTML='';
    board.style.gridTemplateColumns=`repeat(${cols}, 1fr)`; board.style.gridTemplateRows=`repeat(${rows}, 1fr)`;
    const arr=shuffle(Array.from({length:max},(_,i)=>i+1));
    arr.forEach(n=>{
      const c=document.createElement('button');
      c.type='button'; c.className='cell'; c.textContent=n; c.setAttribute('aria-label','angka '+n);
      c.addEventListener('click',()=>onClick(c,n));
      board.appendChild(c);
    });
    remaining=time; timeEl.textContent=remaining.toFixed(3);
    stopTicker(true);
    if(chaos) startChaos();
  }

  /* ================= TIMER ================= */
  function startTicker(){
    started=true; deadline=performance.now()+remaining*1000;
    ticker=setInterval(()=>{
      remaining=(deadline-performance.now())/1000; if(remaining<0) remaining=0;
      timeEl.textContent=remaining.toFixed(3);
      if(remaining===0){ stopTicker(); gameOver(); }
    }, 25);
  }
  function stopTicker(reset=false){ if(ticker){clearInterval(ticker); ticker=null} if(reset) started=false }

  /* ================= CHAOS MODE ================= */
  function startChaos(){
    stopChaos();
    chaosTimer=setInterval(()=>{
      board.classList.add('shake'); setTimeout(()=>board.classList.remove('shake'), 260);
      const cells=[...board.querySelectorAll('.cell:not([disabled])')];
      for(let i=0;i<6 && cells.length>1;i++){
        const a=rand(0,cells.length-1), b=rand(0,cells.length-1);
        if(a!==b){ board.insertBefore(cells[a], cells[b]); }
      }
    }, 4000);
  }
  function stopChaos(){ if(chaosTimer){ clearInterval(chaosTimer); chaosTimer=null } }

  /* ================= AUDIO & EFFECTS ================= */
  function pop(ok=true){
    const ctx='AudioContext' in window ? audioCtx : null; if(!ctx) return;
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='triangle'; o.frequency.value=ok?760:200; g.gain.value=.0001;
    o.connect(g); g.connect(ctx.destination); o.start();
    const t=ctx.currentTime; g.gain.exponentialRampToValueAtTime(.28, t+.01); g.gain.exponentialRampToValueAtTime(.0001, t+.1); o.stop(t+.12);
  }
  function confetti(n=180){
    for(let i=0;i<n;i++){
      const e=document.createElement('div'); e.className='confetti';
      e.style.left=(50+(Math.random()*60-30))+'vw';
      e.style.background=`hsl(${Math.random()*360}, 90%, 60%)`;
      e.style.setProperty('--x', (Math.random()*100 - 50)+'vw');
      e.style.setProperty('--t', (2+Math.random()*1.8)+'s');
      document.body.appendChild(e); e.addEventListener('animationend', ()=>e.remove());
    }
  }
  function toastMsg(t){ const el=$('#toast'); el.textContent=t; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), 1800) }

  /* ================= STORAGE ================= */
  const key=(lvl)=>`nr_best_${lvl}`;
  const loadBest=(lvl)=>{const v=localStorage.getItem(key(lvl)); return v?parseFloat(v):null};
  const saveBest=(lvl,val)=>{const b=loadBest(lvl); if(b==null||val<b){localStorage.setItem(key(lvl), String(val.toFixed(3))); return true} return false};
  const renderBest=(lvl)=>{const b=loadBest(lvl); bestEl.textContent=b?`${b.toFixed(3)}s`:'—'};

  /* ================= GAMEPLAY ================= */
  let lastHit=0, combo=0;
  function penalize(sec){ remaining=Math.max(0, remaining-sec); chipTime.classList.add('warn'); setTimeout(()=>chipTime.classList.remove('warn'), 300); }
  function addTime(sec){ remaining+=sec; deadline+=sec*1000; toastMsg(`Bonus +${sec}s ⏱️`); }

  function onClick(cell,n){
    if(!started){ audioCtx?.resume?.(); startTicker(); lastHit=performance.now(); }
    if(n===seq){
      cell.classList.add('correct'); cell.disabled=true; seq++; targetEl.textContent= seq<=maxN? seq : '✔'; pop(true);
      const now=performance.now();
      if(now-lastHit<=900){ combo++; } else { combo=1; }
      lastHit=now; comboEl.textContent=String(Math.min(combo,5));
      if(combo>=5){ addTime(3); combo=0; comboEl.textContent='0'; }
      if(seq>maxN){
        stopTicker(); const used=levels[parseInt(levelSel.value,10)].time - remaining;
        const isBest=saveBest(parseInt(levelSel.value,10), used); renderBest(parseInt(levelSel.value,10));
        confetti(200); toastMsg(isBest?'Rekor baru! 🎉':'Selesai! ✅');
      }
    } else {
      pop(false); board.classList.remove('shake'); void board.offsetWidth; board.classList.add('shake');
      cell.classList.add('wrong'); setTimeout(()=>cell.classList.remove('wrong'),220);
      penalize(2); if(remaining===0){ stopTicker(); gameOver(); }
    }
  }

  function gameOver(){ toastMsg('Waktu habis! ⏰'); board.querySelectorAll('.cell').forEach(c=>c.disabled=true); }

  function start(){
    const lvl=parseInt(levelSel.value,10), cfg=levels[lvl];
    buildSky(); buildGrid(cfg); renderBest(lvl);
  }

  btn.addEventListener('click', start);
  levelSel.addEventListener('change', start);
  chaosBtn.addEventListener('click', ()=>{ chaos=!chaos; chaosBtn.textContent=`Chaos: ${chaos?'ON':'OFF'}`; if(chaos) startChaos(); else stopChaos(); });

  // INIT
  buildSky(); buildGrid(levels[1]); renderBest(1);
})();
</script>
</body>
</html>
