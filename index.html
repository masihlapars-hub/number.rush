<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Number Rush — Sky Chaos</title>
  <style>
    :root{ --ink:#0f172a; --muted:#334155; --line:rgba(255,255,255,.35); --p1:#7c3aed; --p2:#a78bfa; --ok:#22c55e; --err:#ef4444; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;
      background: linear-gradient(180deg,#bde0ff 0%,#a8d0ff 60%,#9bc8ff 100%);
      min-height:100svh;
      padding:max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right))
              max(12px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
      overflow:auto;
    }

    /* Background */
    .bg-back{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden}
    .sun{position:absolute; right:4vw; top:4vh; width:110px; height:110px; border-radius:50%;
         background:#ffd166; box-shadow:0 0 70px #ffd166bb, inset -14px -16px 0 #ffc43d; animation:pulse 4s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
    .bg-cloud{position:absolute; background:#fff; border-radius:60px; filter:drop-shadow(0 12px 26px rgba(0,0,0,.16))}
    .bg-cloud:before,.bg-cloud:after{content:""; position:absolute; background:#fff; border-radius:80px}
    .bg-cloud:before{width:70%; height:70%; left:-25%; top:10%}
    .bg-cloud:after{width:55%; height:55%; right:-20%; top:20%}
    @keyframes driftRight{from{transform:translateX(-150%)} to{transform:translateX(150%)}}
    .bg-cloud{animation:driftRight var(--t,85s) linear infinite; opacity:.9}

    /* Panel */
    .wrap{position:relative; z-index:1; display:grid; place-items:center; min-height:calc(100svh - 24px)}
    .card{width:min(1120px,100%); background:rgba(255,255,255,.22); backdrop-filter: blur(12px) saturate(170%);
          border:1px solid var(--line); border-radius:18px; box-shadow:0 18px 46px rgba(15,23,42,.22); overflow:hidden}
    header{display:flex; gap:12px; align-items:center; padding:14px 16px; border-bottom:1px solid var(--line);
           background:linear-gradient(180deg, rgba(255,255,255,.34), rgba(255,255,255,.18))}
    .logo{width:30px; height:30px; display:grid; place-items:center; border-radius:10px; color:#fff; font-weight:800;
          background:conic-gradient(from 120deg, var(--p1), var(--p2))}
    header h1{font-size:18px; margin:0}
    .sub{font-size:12px; color:#1f2937}
    .content{display:grid; gap:14px; padding:14px}
    @media (min-width:980px){ .content{ grid-template-columns: 1.15fr .85fr; } }
    .panel{background:rgba(255,255,255,.18); border:1px solid var(--line); border-radius:16px; padding:14px; backdrop-filter: blur(10px)}
    .hud{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-bottom:10px}
    .stats{display:flex; gap:10px; flex-wrap:wrap}
    .chip{background:rgba(255,255,255,.55); border:1px solid var(--line); padding:8px 10px; border-radius:999px; font-size:13px; display:flex; gap:8px; align-items:center}
    .chip b{font-variant-numeric:tabular-nums}
    .chip.warn{box-shadow:0 0 0 3px #fecacaaa}
    select{border:1px solid var(--line); background:rgba(255,255,255,.95); padding:8px 10px; border-radius:10px; font-weight:700}
    .btn{appearance:none; border:0; background:linear-gradient(180deg, var(--p1), var(--p2)); color:#fff; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer; box-shadow:0 12px 28px rgba(124,58,237,.45)}
    .btn:active{transform:translateY(1px) scale(.99)}
    .toggle{appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.5); padding:8px 10px; border-radius:10px; font-weight:700; cursor:pointer}

    /* Board */
    .board-wrap{position:relative; display:grid; place-items:center}
    .board{
      width:100%; max-width:100%; block-size:min(72svh, 76vw); aspect-ratio:1/1;
      background: transparent; border-radius:14px; display:grid; gap:8px; padding:10px; overflow:hidden;
      border:1px solid rgba(255,255,255,.45);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.18), 0 18px 36px rgba(0,0,0,.12);
    }
    .cell{
      display:grid; place-items:center; background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      font-weight:900; color:#0f172a;
      font-size: clamp(16px, 3vmin, 28px);
      user-select:none; cursor:pointer; transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
      box-shadow:0 8px 16px rgba(15,23,42,.12)
    }
    .cell:hover{ box-shadow:0 14px 24px rgba(15,23,42,.18) }
    .cell.correct{ background:#ecfdf5; border-color:#bbf7d0 }
    .cell.wrong{ background:#fef2f2; border-color:#fecaca }
    .shake{ animation:shake .28s linear }
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
  </style>
</head>
<body>
  <div class="bg-back" aria-hidden="true" id="bg"><div class="sun"></div></div>

  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo">NR</div>
        <div>
          <h1>Number Rush — <b>Sky Chaos</b></h1>
          <div class="sub">Burung, layangan, dan bintang jatuh tampil <b>di depan board</b>. Musik latar menyala saat mulai.</div>
        </div>
      </header>

      <div class="content">
        <div class="panel">
          <div class="hud">
            <div class="stats">
              <div class="chip">Level:
                <select id="level">
                  <option value="1">1 • 1–20 • 25s</option>
                  <option value="2">2 • 1–30 • 35s</option>
                  <option value="3">3 • 1–40 • 45s</option>
                  <option value="4">4 • 1–50 • 55s</option>
                  <option value="5">5 • 1–60 • 65s</option>
                </select>
              </div>
              <div class="chip">Target: <b id="target">1</b></div>
              <div class="chip" id="chipTime">Sisa: <b id="time">25.000</b>s</div>
              <div class="chip">Rekor: <b id="best">—</b></div>
              <div class="chip">Combo: <b id="combo">0</b>/5</div>
            </div>
            <div style="display:flex; gap:8px; align-items:center">
              <button class="toggle" id="toggleMusic">Music: ON</button>
              <button class="toggle" id="toggleStorm">Storm: OFF</button>
              <button class="btn" id="btnStart">Mulai / Ulang</button>
            </div>
          </div>

          <div class="board-wrap">
            <div id="board" class="board"></div>
            <div class="fx-front" id="fxFront" aria-hidden="true"></div>
          </div>
        </div>

        <aside class="panel sidebar">
          <h3 class="title">Aturan cepat</h3>
          <div class="list">
            <div class="row"><span>Countdown</span><span class="tag">habis → game over</span></div>
            <div class="row"><span>Combo</span><span class="tag">5 cepat → +3s</span></div>
            <div class="row"><span>Salah</span><span class="tag">-2s & shake</span></div>
            <div class="row"><span>Storm Mode</span><span class="tag">efek 2× lebih banyak</span></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Rekor baru! 🎉</div>

  <!-- MUSIK LATAR -->
  <audio id="bgm" loop src="happy_bgm.mp3" preload="auto"></audio>

<script>
(() => {
  const $ = (s, o = document) => o.querySelector(s);
  const rand = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;
  const shuffle = (a) => {
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  const levelSel = $('#level'),
        targetEl = $('#target'),
        timeEl = $('#time'),
        bestEl = $('#best'),
        comboEl = $('#combo'),
        board = $('#board'),
        btn = $('#btnStart'),
        toast = $('#toast'),
        stormBtn = $('#toggleStorm'),
        musicBtn = $('#toggleMusic'),
        bgm = $('#bgm');

  const BG = $('#bg');
  const FX = $('#fxFront');

  const levels = {
    1: { max: 20, cols: 5, rows: 4, time: 25 },
    2: { max: 30, cols: 6, rows: 5, time: 35 },
    3: { max: 40, cols: 7, rows: 6, time: 45 },
    4: { max: 50, cols: 8, rows: 7, time: 55 },
    5: { max: 60, cols: 8, rows: 8, time: 65 }
  };

  let seq = 1,
      maxN = 20,
      started = false,
      deadline = 0,
      ticker = null,
      remaining = 0;
  let lastHit = 0, combo = 0, storm = false;

  function buildBackSky() {
    BG.innerHTML = '<div class="sun"></div>';
    for (let i = 0; i < 8; i++) {
      const c = document.createElement('div');
      c.className = 'bg-cloud';
      const sz = rand(100, 200);
      c.style.width = sz + 'px';
      c.style.height = sz * 0.45 + 'px';
      c.style.top = rand(8, 70) + 'vh';
      c.style.left = rand(-140, -40) + '%';
      c.style.setProperty('--t', rand(70, 100) + 's');
      BG.appendChild(c);
    }
  }

  function spawnBird(leftToRight = true) {
    const b = document.createElement('div');
    b.className = 'bird';
    b.style.top = rand(8, 85) + '%';
    b.style.setProperty('--bd', (storm ? 6 : 9) + 's');
    if (!leftToRight) {
      b.style.transform = 'scaleX(-1)';
      b.style.animation = 'birdFly var(--bd) linear reverse forwards';
      b.style.left = '115vw';
    }
    FX.appendChild(b);
    b.addEventListener('animationend', () => b.remove());
  }

  function spawnKite() {
    const k = document.createElement('div');
    k.className = 'kite';
    k.style.setProperty('--kd', (storm ? 9 : 12) + 's');
    FX.appendChild(k);
    k.addEventListener('animationend', () => k.remove());
  }

  function spawnShoot() {
    const s = document.createElement('div');
    s.className = 'shoot';
    FX.appendChild(s);
    s.addEventListener('animationend', () => s.remove());
  }

  let ivBird, ivKite, ivShoot;
  function startFX() {
    stopFX();
    ivBird = setInterval(() => spawnBird(Math.random() > 0.5), storm ? 1400 : 2400);
    ivKite = setInterval(spawnKite, storm ? 2800 : 4600);
    ivShoot = setInterval(spawnShoot, storm ? 2800 : 5200);
  }

  function stopFX() {
    [ivBird, ivKite, ivShoot].forEach(x => x && clearInterval(x));
  }

  function buildGrid(cfg) {
    const { max, cols, rows, time } = cfg;
    maxN = max;
    seq = 1;
    targetEl.textContent = '1';
    combo = 0;
    comboEl.textContent = '0';
    board.classList.remove('shake');
    board.innerHTML = '';
    board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    board.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    const arr = shuffle(Array.from({ length: max }, (_, i) => i + 1));
    arr.forEach(n => {
      const c = document.createElement('button');
      c.type = 'button';
      c.className = 'cell';
      c.textContent = n;
      c.setAttribute('aria-label', 'angka ' + n);
      c.addEventListener('click', () => onClick(c, n));
      board.appendChild(c);
    });
    remaining = time;
    timeEl.textContent = remaining.toFixed(3);
    stopTicker(true);
  }

  function startTicker() {
    started = true;
    deadline = performance.now() + remaining * 1000;
    ticker = setInterval(() => {
      remaining = (deadline - performance.now()) / 1000;
      if (remaining < 0) remaining = 0;
      timeEl.textContent = remaining.toFixed(3);
      if (remaining === 0) {
        stopTicker();
        gameOver();
      }
    }, 25);
  }

  function stopTicker(reset = false) {
    if (ticker) { clearInterval(ticker); ticker = null; }
    if (reset) started = false;
  }

  function pop(ok = true) {
    if (!audioCtx) return;
    const o = audioCtx.createOscillator(),
          g = audioCtx.createGain();
    o.type = 'triangle';
    o.frequency.value = ok ? 760 : 210;
    g.gain.value = .0001;
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start();
    const t = audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(.26, t + .01);
    g.gain.exponentialRampToValueAtTime(.0001, t + .1);
    o.stop(t + .12);
  }

  function gameOver() {
    toast.textContent = 'Game Over! ⏰';
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 1800);
    board.querySelectorAll('.cell').forEach(c => c.disabled = true);
  }

  function onClick(cell, n) {
    if (!started) {
      startTicker();
    }
    if (n === seq) {
      cell.classList.add('correct');
      cell.disabled = true;
      seq++;
      targetEl.textContent = seq <= maxN ? seq : '✔';
      pop(true);
      if (seq > maxN) {
        stopTicker();
        gameOver();
      }
    } else {
      cell.classList.add('wrong');
      setTimeout(() => cell.classList.remove('wrong'), 300);
      pop(false);
      penalize(2);
    }
  }
})();
</script>
</body>
</html>
